# 数据库时区修正提案

## 概述
当前系统数据库中的时间戳使用 SQLite 的 `CURRENT_TIMESTAMP`（UTC 时间），与北京时间（UTC+8）不一致，导致用户看到的时间比实际北京时间晚 8 小时。

## 问题分析
- **问题**: 数据库表格中显示的时间比北京时间晚 8 小时
- **根本原因**: SQLite 的 `CURRENT_TIMESTAMP` 返回 UTC 时间，而系统需要北京时间
- **影响范围**: 所有涉及时间戳的表和功能
  - `multi_orders.created_at`
  - `device_bindings.created_at`, `device_bindings.last_accessed_at`
  - `order_usage.accessed_at`
  - 24小时访问窗口期的时间计算

## 解决方案
实施统一的时区处理策略，确保所有时间戳都使用北京时间。

## 技术方案

### 1. 数据库配置修改
- 配置 SQLite 连接时设置时区
- 修改现有表的时间戳列默认值
- 创建时区转换函数

### 2. 应用层时区处理
- 在数据库操作中统一使用北京时间
- 修改现有代码中的时间处理逻辑
- 确保前后端时间显示一致

### 3. 数据迁移
- 将现有 UTC 时间戳转换为北京时间
- 保持数据完整性和一致性

## 实施步骤
详见 `tasks.md` 文件。

## 风险评估
- **低风险**: 主要是显示和计算逻辑的修改
- **数据安全**: 需要备份数据库后进行迁移
- **向后兼容**: 确保现有功能不受影响

## 验收标准
- 数据库中新记录使用北京时间
- 现有数据正确转换为北京时间显示
- 前端界面显示正确的时间
- 24小时窗口期计算使用北京时间