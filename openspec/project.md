# 项目上下文

## 项目目标
Order-access 是一个基于订单号的轻量级内容访问验证系统，用于限制教程页面的查看权限。专为虚拟产品销售场景设计（特别适用于小红书自动发货场景），系统通过订单号输入验证用户访问权限，同时通过会话管理和使用计数来防止未授权访问。

系统区分两种订单类型：
- **单次订单**：仅允许首次访问
- **多次订单**：允许无限次访问（或自定义限制）高级内容

## 技术栈
- **后端**: Node.js + Express.js
- **数据库**: SQLite + better-sqlite3
- **限流**: express-rate-limit
- **会话管理**: Cookie-session 或 JWT（2小时会话保持）
- **反向代理**: Caddy/Nginx
- **开发规范**: OpenSpec 需求和迭代规范管理
- **CLI工具**: 内置订单管理工具

## 项目规范

### 代码风格
- JavaScript/Node.js 使用 ES6+ 语法
- 模块化架构，API、数据库、CLI组件清晰分离
- 中文注释和文档（项目主要语言）
- 安全优先，统一失败消息

### 架构模式
- **Express REST API**: `/api/verify` 订单验证，`/api/multi/add` 白名单管理
- **SQLite 数据库**: 两个主要表 - `multi_orders`（白名单）和 `order_usage`（访问跟踪）
- **CLI 管理**: 通过命令行界面进行订单管理
- **原子操作**: 通过数据库级原子性防止并发访问攻击

### 测试策略
- 通过API端点进行手动测试
- CLI工具验证订单管理功能
- 限流验证（每IP/UA每分钟60次请求）
- 会话过期测试（2小时超时）

### Git 工作流
- 主分支用于生产部署
- 功能分支开发新功能
- OpenSpec集成进行需求管理
- 中文提交消息保持一致性

## 领域背景
该系统服务于小红书、微信和独立网站等数字内容卖家。核心领域概念：

- **订单号**: 客户购买的唯一标识符
- **访问控制**: 基于购买有效性限制教程/内容查看
- **会话持久性**: 验证后2小时持续访问窗口
- **白名单管理**: 手动或CSV导入多次使用订单号
- **防枚举**: 统一失败消息防止暴力破解发现订单

## 重要约束
- **安全性**: 不暴露订单状态，所有失败返回相同消息
- **性能**: SQLite轻量级部署，最小依赖
- **可扩展性**: 面向中小型数字内容卖家设计
- **可移植性**: 通过SQLite基于文件的数据库轻松迁移
- **合规性**: 适合中国数字内容市场法规

## 外部依赖
- **Node.js 运行环境**: 需要18+版本
- **VPS/主机**: 任何兼容Node.js的托管环境
- **反向代理**: Nginx或Caddy用于HTTPS终止
- **支付平台**: 与小红书等中国电商平台集成
- **CSV导入**: 通过电子表格批量订单管理
